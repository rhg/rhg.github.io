{"componentChunkName":"component---src-templates-blog-post-js","path":"/what-to-pass/","webpackCompilationHash":"949a47ebb64160e6f5e7","result":{"data":{"site":{"siteMetadata":{"title":"tehblog","author":"Ricardo Gomez"}},"markdownRemark":{"id":"2b967d3e-2b10-5c80-8dfa-8d714ab59740","excerpt":"Mapping a function over a channel You have a function you are developing: and you want to run this on maps you get over, say, a socket. Thus you shove it up a…","html":"<h2>Mapping a function over a channel</h2>\n<p>You have a function you are developing:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">(defn name-string\n  &quot;Gives you the name string from a suitable map&quot;\n  [{:keys [first-name]}]\n  first-name)</code></pre></div>\n<p>and you want to run this on maps you get over, say, a socket. Thus you shove it up a channel with an attached transducer of <code class=\"language-text\">(map name-string)</code> (or with a pipeline of the actual data channel, for the indirection).</p>\n<h2>A Problem Arises</h2>\n<p>Now, you want to incorporate the last name as an initial. Thus:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">(defn name-string\n  &quot;Gives you a first name with a last name initial&quot;\n  [{:keys [first-name last-name]}]\n  (str first-name \\space (first last-name) &quot;.&quot;))</code></pre></div>\n<p>But, oh noes! The old definition is still used. Naïvely you would restart the input source (or if you did use indirection, point it to a new channel). There is a better way, for development purposes. This does incur a small overhead and allows a feature which may be a security hole in production.</p>\n<h2>What is <code class=\"language-text\">a-function</code></h2>\n<p>This will resolve at compile time to the current value of the var named by the symbol (or just the value bound to it if a local). This is usually an IFn instance if it’s a function. This works fine and dandy in a language with no runtime definitions—<em>cough</em> java <em>cough</em>—but it falls flat when used in a dynamic language. It is consistent and logical, unfortunately it does sometimes surprise people when redefinitions do nothing.</p>\n<h2>What Is #‘a-function</h2>\n<p>At read time this will turn to <code class=\"language-text\">(var a-function)</code>. At runtime it evaluates to a <code class=\"language-text\">clojure.lang.Var</code> object if a-function is a global. The meta-magic here is that <code class=\"language-text\">Var</code> implements <code class=\"language-text\">IFn</code>, and if it’s a var for a function, invoking the var will invoke the function the var currently points at. I can hear thosee of you saying “that’s a reference,” and you are indeed correctish. <code class=\"language-text\">Var</code>s are one in the sense they allow mutability, but they also don’t allow much else. You can also change the root binding atomically (I think), and if it is marked dynamic (by having <code class=\"language-text\">:dynamic true</code> in the metadata) you can change the current thread binding for a function call.</p>\n<h2>Just Show Me The Codes!</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">(require &#39;[clojure.core.async :as a])\n;=&gt; nil\n\n(defn my-char\n  [x]\n  (char x))\n;=&gt; #&#39;user/my-char\n\n(def ch (a/chan 1 (map my-char)))\n;=&gt; #&#39;user/ch\n\n(a/&gt;!! ch 97)\n;=&gt; true\n\n(a/&lt;!! ch)\n;=&gt; \\a\n\n; now let&#39;s redefine our function\n\n(alter-var-root #&#39;my-char comp inc)\n\n; now it incs the number before turning it to a character\n\n(a/&gt;!! ch 97)\n;=&gt; true\n\n(= \\b (a/&lt;!! ch))\n;=&gt; false\n\n; oh noez! press the panic button!\n\n; or do this when creating the channel\n\n(defn my-char\n  [x]\n  (char x))\n;=&gt; #&#39;user/my-char\n\n(def ch (a/chan 1 (map #&#39;my-char)))\n;=&gt; user/ch\n\n(a/&gt;!! ch 97)\n;=&gt; true\n\n(= \\a (a/&lt;!! ch))\n;=&gt; true\n\n(alter-var-root #&#39;my-char comp inc)\n;=&gt; an instance of IFn\n\n(a/&gt;!! ch 97)\n;=&gt; true\n\n(= \\b (a/&lt;!! ch))\n;=&gt; true\n\n; yay!</code></pre></div>","frontmatter":{"title":"What to Pass: a Var or IFn?","date":"August 23, 2015","description":null}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/what-to-pass/","previous":{"fields":{"slug":"/on-licensing/"},"frontmatter":{"title":"On Licensing"}},"next":{"fields":{"slug":"/dependency/"},"frontmatter":{"title":"Dependency is Not Addiction"}}}}}